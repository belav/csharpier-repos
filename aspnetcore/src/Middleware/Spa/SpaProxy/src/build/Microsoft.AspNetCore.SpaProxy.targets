<Project>
  <Target Name="WriteSpaConfigurationToDisk" BeforeTargets="AssignTargetPaths">
    <PropertyGroup>
      <_SpaProxyServerLaunchConfig
        >$(IntermediateOutputPath)spa.proxy.json</_SpaProxyServerLaunchConfig
      >
      <_SpaRootFullPath
        >$([System.IO.Path]::Combine('$(MSBuildProjectDirectory)', '$(SpaRoot)').Replace('\','\\'))</_SpaRootFullPath
      >
      <SpaProxyTimeoutInSeconds Condition="'$(SpaProxyTimeoutInSeconds)' == ''"
        >120</SpaProxyTimeoutInSeconds
      >
      <SpaProxyKeepRunning Condition="'$(SpaProxyKeepRunning)' == ''">false</SpaProxyKeepRunning>
    </PropertyGroup>
    <ItemGroup>
      <_SpaProxyServerLaunchConfigLines Include="{" />
      <_SpaProxyServerLaunchConfigLines Include="  "SpaProxyServer": {" />
      <_SpaProxyServerLaunchConfigLines Include="    "ServerUrl": "$(SpaProxyServerUrl)"," />
      <_SpaProxyServerLaunchConfigLines Include="    "RedirectUrl": "$(SpaProxyRedirectUrl)"," />
      <_SpaProxyServerLaunchConfigLines
        Include="    "LaunchCommand": "$(SpaProxyLaunchCommand)","
      />
      <_SpaProxyServerLaunchConfigLines Include="    "WorkingDirectory": "$(_SpaRootFullPath)"," />
      <_SpaProxyServerLaunchConfigLines
        Include="    "MaxTimeoutInSeconds": "$(SpaProxyTimeoutInSeconds)","
      />
      <_SpaProxyServerLaunchConfigLines Include="    "KeepRunning": "$(SpaProxyKeepRunning)"" />
      <_SpaProxyServerLaunchConfigLines Include="  }" />
      <_SpaProxyServerLaunchConfigLines Include="}" />
    </ItemGroup>
    <WriteLinesToFile
      File="$(_SpaProxyServerLaunchConfig)"
      Lines="@(_SpaProxyServerLaunchConfigLines)"
      WriteOnlyWhenDifferent="true"
      Overwrite="true"
    />
    <ItemGroup>
      <ContentWithTargetPath
        Include="$(_SpaProxyServerLaunchConfig)"
        CopyToOutputDirectory="PreserveNewest"
        CopyToPublishDirectory="Never"
        TargetPath="spa.proxy.json"
      />
      <FileWrites Include="$(_SpaProxyServerLaunchConfig)" />
    </ItemGroup>
  </Target>
</Project>
